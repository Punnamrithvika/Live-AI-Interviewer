{"ast":null,"code":"var _process$env$REACT_AP,\n  _s = $RefreshSig$();\nimport { useState, useEffect, useRef, useCallback } from 'react';\nconst WS_BASE_URL = ((_process$env$REACT_AP = process.env.REACT_APP_API_URL) === null || _process$env$REACT_AP === void 0 ? void 0 : _process$env$REACT_AP.replace('http', 'ws')) || 'ws://localhost:8000';\n\n/**\n * Custom hook for WebSocket connection\n * Handles real-time chat communication with the backend\n */\nexport const useWebSocket = sessionId => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [error, setError] = useState(null);\n  const ws = useRef(null);\n  const reconnectTimeout = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // Connect to WebSocket\n  const connect = useCallback(() => {\n    if (!sessionId) {\n      console.warn('No session ID provided for WebSocket');\n      return;\n    }\n    try {\n      const wsUrl = `${WS_BASE_URL}/ws/chat/${sessionId}`;\n      console.log('Connecting to WebSocket:', wsUrl);\n      ws.current = new WebSocket(wsUrl);\n      ws.current.onopen = () => {\n        console.log('WebSocket connected');\n        setIsConnected(true);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n      ws.current.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n          setMessages(prev => [...prev, data]);\n        } catch (err) {\n          console.error('Error parsing WebSocket message:', err);\n        }\n      };\n      ws.current.onerror = event => {\n        console.error('WebSocket error:', event);\n        setError('WebSocket connection error');\n      };\n      ws.current.onclose = () => {\n        console.log('WebSocket disconnected');\n        setIsConnected(false);\n\n        // Attempt to reconnect\n        if (reconnectAttempts.current < maxReconnectAttempts) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 10000);\n          console.log(`Reconnecting in ${delay}ms... (attempt ${reconnectAttempts.current + 1})`);\n          reconnectTimeout.current = setTimeout(() => {\n            reconnectAttempts.current += 1;\n            connect();\n          }, delay);\n        } else {\n          setError('Failed to connect to server. Please refresh the page.');\n        }\n      };\n    } catch (err) {\n      console.error('Error creating WebSocket:', err);\n      setError('Failed to establish WebSocket connection');\n    }\n  }, [sessionId]);\n\n  // Send message through WebSocket\n  const sendMessage = useCallback((type, data) => {\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\n      const message = {\n        type,\n        ...data,\n        timestamp: new Date().toISOString()\n      };\n      console.log('Sending WebSocket message:', message);\n      ws.current.send(JSON.stringify(message));\n    } else {\n      console.error('WebSocket is not connected');\n      setError('Not connected to server');\n    }\n  }, []);\n\n  // Send candidate answer\n  const sendAnswer = useCallback(message => {\n    sendMessage('answer', {\n      message\n    });\n  }, [sendMessage]);\n\n  // Send ping (heartbeat)\n  const sendPing = useCallback(() => {\n    sendMessage('ping', {});\n  }, [sendMessage]);\n\n  // Disconnect WebSocket\n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    setIsConnected(false);\n  }, []);\n\n  // Connect on mount, disconnect on unmount\n  useEffect(() => {\n    if (sessionId) {\n      connect();\n    }\n    return () => {\n      disconnect();\n    };\n  }, [sessionId, connect, disconnect]);\n\n  // Heartbeat to keep connection alive\n  useEffect(() => {\n    if (!isConnected) return;\n    const heartbeatInterval = setInterval(() => {\n      sendPing();\n    }, 30000); // Send ping every 30 seconds\n\n    return () => {\n      clearInterval(heartbeatInterval);\n    };\n  }, [isConnected, sendPing]);\n  return {\n    isConnected,\n    messages,\n    error,\n    sendAnswer,\n    sendMessage,\n    disconnect,\n    reconnect: connect\n  };\n};\n_s(useWebSocket, \"y27x6w/kTV7f11R5acKgeM+1B90=\");\nexport default useWebSocket;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","WS_BASE_URL","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","useWebSocket","sessionId","_s","isConnected","setIsConnected","messages","setMessages","error","setError","ws","reconnectTimeout","reconnectAttempts","maxReconnectAttempts","connect","console","warn","wsUrl","log","current","WebSocket","onopen","onmessage","event","data","JSON","parse","prev","err","onerror","onclose","delay","Math","min","pow","setTimeout","sendMessage","type","readyState","OPEN","message","timestamp","Date","toISOString","send","stringify","sendAnswer","sendPing","disconnect","clearTimeout","close","heartbeatInterval","setInterval","clearInterval","reconnect"],"sources":["C:/Users/rithv/OneDrive/Desktop/mp_interviewer/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\n\nconst WS_BASE_URL = process.env.REACT_APP_API_URL?.replace('http', 'ws') || 'ws://localhost:8000';\n\n/**\n * Custom hook for WebSocket connection\n * Handles real-time chat communication with the backend\n */\nexport const useWebSocket = (sessionId) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [error, setError] = useState(null);\n  const ws = useRef(null);\n  const reconnectTimeout = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // Connect to WebSocket\n  const connect = useCallback(() => {\n    if (!sessionId) {\n      console.warn('No session ID provided for WebSocket');\n      return;\n    }\n\n    try {\n      const wsUrl = `${WS_BASE_URL}/ws/chat/${sessionId}`;\n      console.log('Connecting to WebSocket:', wsUrl);\n      \n      ws.current = new WebSocket(wsUrl);\n\n      ws.current.onopen = () => {\n        console.log('WebSocket connected');\n        setIsConnected(true);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n\n      ws.current.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n          \n          setMessages((prev) => [...prev, data]);\n        } catch (err) {\n          console.error('Error parsing WebSocket message:', err);\n        }\n      };\n\n      ws.current.onerror = (event) => {\n        console.error('WebSocket error:', event);\n        setError('WebSocket connection error');\n      };\n\n      ws.current.onclose = () => {\n        console.log('WebSocket disconnected');\n        setIsConnected(false);\n        \n        // Attempt to reconnect\n        if (reconnectAttempts.current < maxReconnectAttempts) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 10000);\n          console.log(`Reconnecting in ${delay}ms... (attempt ${reconnectAttempts.current + 1})`);\n          \n          reconnectTimeout.current = setTimeout(() => {\n            reconnectAttempts.current += 1;\n            connect();\n          }, delay);\n        } else {\n          setError('Failed to connect to server. Please refresh the page.');\n        }\n      };\n    } catch (err) {\n      console.error('Error creating WebSocket:', err);\n      setError('Failed to establish WebSocket connection');\n    }\n  }, [sessionId]);\n\n  // Send message through WebSocket\n  const sendMessage = useCallback((type, data) => {\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\n      const message = {\n        type,\n        ...data,\n        timestamp: new Date().toISOString(),\n      };\n      \n      console.log('Sending WebSocket message:', message);\n      ws.current.send(JSON.stringify(message));\n    } else {\n      console.error('WebSocket is not connected');\n      setError('Not connected to server');\n    }\n  }, []);\n\n  // Send candidate answer\n  const sendAnswer = useCallback((message) => {\n    sendMessage('answer', { message });\n  }, [sendMessage]);\n\n  // Send ping (heartbeat)\n  const sendPing = useCallback(() => {\n    sendMessage('ping', {});\n  }, [sendMessage]);\n\n  // Disconnect WebSocket\n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    \n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    \n    setIsConnected(false);\n  }, []);\n\n  // Connect on mount, disconnect on unmount\n  useEffect(() => {\n    if (sessionId) {\n      connect();\n    }\n\n    return () => {\n      disconnect();\n    };\n  }, [sessionId, connect, disconnect]);\n\n  // Heartbeat to keep connection alive\n  useEffect(() => {\n    if (!isConnected) return;\n\n    const heartbeatInterval = setInterval(() => {\n      sendPing();\n    }, 30000); // Send ping every 30 seconds\n\n    return () => {\n      clearInterval(heartbeatInterval);\n    };\n  }, [isConnected, sendPing]);\n\n  return {\n    isConnected,\n    messages,\n    error,\n    sendAnswer,\n    sendMessage,\n    disconnect,\n    reconnect: connect,\n  };\n};\n\nexport default useWebSocket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}