{"ast":null,"code":"import _objectSpread from\"/Users/pruthanj/d/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _process$env$REACT_AP;import{useState,useEffect,useRef,useCallback}from'react';const WS_BASE_URL=((_process$env$REACT_AP=process.env.REACT_APP_API_URL)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.replace('http','ws'))||'ws://localhost:8000';/**\n * Custom hook for WebSocket connection\n * Handles real-time chat communication with the backend\n */export const useWebSocket=sessionId=>{const[isConnected,setIsConnected]=useState(false);const[messages,setMessages]=useState([]);const[error,setError]=useState(null);const ws=useRef(null);const reconnectTimeout=useRef(null);const reconnectAttempts=useRef(0);const maxReconnectAttempts=5;// Connect to WebSocket\nconst connect=useCallback(()=>{if(!sessionId){console.warn('No session ID provided for WebSocket');return;}try{const wsUrl=\"\".concat(WS_BASE_URL,\"/ws/chat/\").concat(sessionId);console.log('Connecting to WebSocket:',wsUrl);ws.current=new WebSocket(wsUrl);ws.current.onopen=()=>{console.log('WebSocket connected');setIsConnected(true);setError(null);reconnectAttempts.current=0;};ws.current.onmessage=event=>{try{const data=JSON.parse(event.data);console.log('WebSocket message received:',data);setMessages(prev=>[...prev,data]);}catch(err){console.error('Error parsing WebSocket message:',err);}};ws.current.onerror=event=>{console.error('WebSocket error:',event);setError('WebSocket connection error');};ws.current.onclose=()=>{console.log('WebSocket disconnected');setIsConnected(false);// Attempt to reconnect\nif(reconnectAttempts.current<maxReconnectAttempts){const delay=Math.min(1000*Math.pow(2,reconnectAttempts.current),10000);console.log(\"Reconnecting in \".concat(delay,\"ms... (attempt \").concat(reconnectAttempts.current+1,\")\"));reconnectTimeout.current=setTimeout(()=>{reconnectAttempts.current+=1;connect();},delay);}else{setError('Failed to connect to server. Please refresh the page.');}};}catch(err){console.error('Error creating WebSocket:',err);setError('Failed to establish WebSocket connection');}},[sessionId]);// Send message through WebSocket\nconst sendMessage=useCallback((type,data)=>{if(ws.current&&ws.current.readyState===WebSocket.OPEN){const message=_objectSpread(_objectSpread({type},data),{},{timestamp:new Date().toISOString()});console.log('Sending WebSocket message:',message);ws.current.send(JSON.stringify(message));}else{console.error('WebSocket is not connected');setError('Not connected to server');}},[]);// Send candidate answer\nconst sendAnswer=useCallback(message=>{sendMessage('answer',{message});},[sendMessage]);// Send ping (heartbeat)\nconst sendPing=useCallback(()=>{sendMessage('ping',{});},[sendMessage]);// Disconnect WebSocket\nconst disconnect=useCallback(()=>{if(reconnectTimeout.current){clearTimeout(reconnectTimeout.current);}if(ws.current){ws.current.close();ws.current=null;}setIsConnected(false);},[]);// Connect on mount, disconnect on unmount\nuseEffect(()=>{if(sessionId){connect();}return()=>{disconnect();};},[sessionId,connect,disconnect]);// Heartbeat to keep connection alive\nuseEffect(()=>{if(!isConnected)return;const heartbeatInterval=setInterval(()=>{sendPing();},30000);// Send ping every 30 seconds\nreturn()=>{clearInterval(heartbeatInterval);};},[isConnected,sendPing]);return{isConnected,messages,error,sendAnswer,sendMessage,disconnect,reconnect:connect};};export default useWebSocket;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","WS_BASE_URL","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","useWebSocket","sessionId","isConnected","setIsConnected","messages","setMessages","error","setError","ws","reconnectTimeout","reconnectAttempts","maxReconnectAttempts","connect","console","warn","wsUrl","concat","log","current","WebSocket","onopen","onmessage","event","data","JSON","parse","prev","err","onerror","onclose","delay","Math","min","pow","setTimeout","sendMessage","type","readyState","OPEN","message","_objectSpread","timestamp","Date","toISOString","send","stringify","sendAnswer","sendPing","disconnect","clearTimeout","close","heartbeatInterval","setInterval","clearInterval","reconnect"],"sources":["/Users/pruthanj/d/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\n\nconst WS_BASE_URL = process.env.REACT_APP_API_URL?.replace('http', 'ws') || 'ws://localhost:8000';\n\n/**\n * Custom hook for WebSocket connection\n * Handles real-time chat communication with the backend\n */\nexport const useWebSocket = (sessionId) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [error, setError] = useState(null);\n  const ws = useRef(null);\n  const reconnectTimeout = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // Connect to WebSocket\n  const connect = useCallback(() => {\n    if (!sessionId) {\n      console.warn('No session ID provided for WebSocket');\n      return;\n    }\n\n    try {\n      const wsUrl = `${WS_BASE_URL}/ws/chat/${sessionId}`;\n      console.log('Connecting to WebSocket:', wsUrl);\n      \n      ws.current = new WebSocket(wsUrl);\n\n      ws.current.onopen = () => {\n        console.log('WebSocket connected');\n        setIsConnected(true);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n\n      ws.current.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n          \n          setMessages((prev) => [...prev, data]);\n        } catch (err) {\n          console.error('Error parsing WebSocket message:', err);\n        }\n      };\n\n      ws.current.onerror = (event) => {\n        console.error('WebSocket error:', event);\n        setError('WebSocket connection error');\n      };\n\n      ws.current.onclose = () => {\n        console.log('WebSocket disconnected');\n        setIsConnected(false);\n        \n        // Attempt to reconnect\n        if (reconnectAttempts.current < maxReconnectAttempts) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 10000);\n          console.log(`Reconnecting in ${delay}ms... (attempt ${reconnectAttempts.current + 1})`);\n          \n          reconnectTimeout.current = setTimeout(() => {\n            reconnectAttempts.current += 1;\n            connect();\n          }, delay);\n        } else {\n          setError('Failed to connect to server. Please refresh the page.');\n        }\n      };\n    } catch (err) {\n      console.error('Error creating WebSocket:', err);\n      setError('Failed to establish WebSocket connection');\n    }\n  }, [sessionId]);\n\n  // Send message through WebSocket\n  const sendMessage = useCallback((type, data) => {\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\n      const message = {\n        type,\n        ...data,\n        timestamp: new Date().toISOString(),\n      };\n      \n      console.log('Sending WebSocket message:', message);\n      ws.current.send(JSON.stringify(message));\n    } else {\n      console.error('WebSocket is not connected');\n      setError('Not connected to server');\n    }\n  }, []);\n\n  // Send candidate answer\n  const sendAnswer = useCallback((message) => {\n    sendMessage('answer', { message });\n  }, [sendMessage]);\n\n  // Send ping (heartbeat)\n  const sendPing = useCallback(() => {\n    sendMessage('ping', {});\n  }, [sendMessage]);\n\n  // Disconnect WebSocket\n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    \n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    \n    setIsConnected(false);\n  }, []);\n\n  // Connect on mount, disconnect on unmount\n  useEffect(() => {\n    if (sessionId) {\n      connect();\n    }\n\n    return () => {\n      disconnect();\n    };\n  }, [sessionId, connect, disconnect]);\n\n  // Heartbeat to keep connection alive\n  useEffect(() => {\n    if (!isConnected) return;\n\n    const heartbeatInterval = setInterval(() => {\n      sendPing();\n    }, 30000); // Send ping every 30 seconds\n\n    return () => {\n      clearInterval(heartbeatInterval);\n    };\n  }, [isConnected, sendPing]);\n\n  return {\n    isConnected,\n    messages,\n    error,\n    sendAnswer,\n    sendMessage,\n    disconnect,\n    reconnect: connect,\n  };\n};\n\nexport default useWebSocket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}